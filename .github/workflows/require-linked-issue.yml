name: Require linked issue

on:
  pull_request:
    types: [opened, edited, synchronize, reopened]

jobs:
  require-linked-issue:
    runs-on: ubuntu-latest
    permissions:
      pull-requests: read
    steps:
      - name: Ensure PR links an issue (Fixes/Closes/Resolves)
        uses: actions/github-script@v7
        with:
          script: |
            const pr = context.payload.pull_request;
            const title = pr?.title ?? "";
            const body = pr?.body ?? "";
            const text = `${title}\n${body}`.trim();

            // Accept e.g.:
            // - Fixes #123
            // - Closes owner/repo#123
            // - Resolves #123
            const re = /\b(?:close[sd]?|fix(?:e[sd])?|resolve[sd]?)\b\s+(?:[A-Za-z0-9_.-]+\/[A-Za-z0-9_.-]+)?#\d+\b/i;

            if (!re.test(text)) {
              core.setFailed(
                "PR description must include an issue-closing keyword, e.g. `Fixes #123` (or `Closes #123` / `Resolves #123`)."
              );
            }
